= Rendering basics
:toc: right
:imagesdir: media/
:sourcedir: ../src

In this chapter we will look into the basic rendering mechanisms, and add some custom rendering to our app as well.

== Dev mode rendering

As you have seen during the setup of Next, each content item automatically map to a page listing available props. These props are fetched by the so-called Enonic Adapter.

By defining custom queries and react components tailored for each content type, we can customise the props passed to the view, and which React template is actually applied.

== Task: Get person content

Let's build our first component - starting with rendring of "person" content types:

NOTE: The full name of your content type should now be `com.example.myproject:person` If you used a different name when creating the Enonic app, update the `.env` file in your Next.js app to reflect this.

. **Add query** by creating the following file in your front-end application
+
.src/components/queries/getPerson.ts
[source,TypeScript]
----
include::{sourcedir}/components/queries/getPerson.ts[]
----
+
This file defines a graphQL query 'getPerson' that will fetch data from the Enonic API. 
+
TIP: You may validate the query by copying it to the GraphQL playground. Replace `APP_NAME_UNDERSCORED` with `com_example_myproject` and set a query variable, try this for instance:
  `{"path": "/hmdb/persons/brad-pitt"}`
+
. **Add the following imports** to component mappings file:
+
.src/components/_mappings.ts
[source,JavaScript]
----
import getPerson from './queries/getPerson';
import {APP_NAME} from '@enonic/nextjs-adapter';
----
+
. Then **Register the query** in the same file:
+
.src/components/_mappings.ts
[source,JavaScript]
----
// Content type mappings
ComponentRegistry.addContentType(`${APP_NAME}:person`, {
    query: getPerson,
    view: PropsView
});
----
+
. **Check the result**
+
By visiting a person item - like `http://localhost:3000/persons/morgan-freeman[http://localhost:3000/persons/morgan-freeman^]` you should now see data props being listed in the view.
+
image:morgan-freeman-props.png[title="Page showing data props for Morgan Freeman content item",width=767px]

== Task: Add person template

With fresh content available, it's time to make things shine:

. **Add view** by creating the following file in your Next.js application
+
.src/components/views/Person.tsx
[source,TypeScript]
----
include::{sourcedir}/components/views/Person.tsx[]
----
+
This file defines a react view `Person` that will use the props from the query to render the person. 
+
. **Register Person view** by adding the following import to the component mappings:
+
.src/components/_mappings.ts
[source,JavaScript]
----
import Person from './views/Person';
----
+
And then update the component mapping you created earlier to use the new view:
+
.src/components/_mappings.ts
[source,JavaScript]
----
// Content type mappings
ComponentRegistry.addContentType(`${APP_NAME}:person`, {
    query: getPerson,
    view: Person
});
----
+
. **Check the result** - The page should automatically reload once the changes have been saved
+
image:morgan-freeman-render.png[title="Person rendering with query and view",width=768px]

The content type mapping applies to every `person` content item in the site, regardless of it's location in the hierarchy. Try looking at some other persons, eg. http://localhost:3000/persons/uma-thurman[http://localhost:3000/persons/uma-thurman^]

== Task: Add custom header and footer

Adding some styles, a header and a footer will make the site more interesting visually. Next.js provides a handy solution to this problem.

The `src/app/layout.tsx` file is called root layout, and by modifying it we can inject the same header and footer components to all pages generated by Next.

TIP: Sample header and footer views are already included in the starter under /`src/components/views`, so all we need to do is put them to work.

Update `src/app/[locale]/[[...contentPath]]/layout.tsx`` with the following changes:

. **Replace first import**
+
[source,TypeScript]
----
import {RENDER_MODE, XP_REQUEST_TYPE} from '@enonic/nextjs-adapter';
----
+
With this:
+
[source,TypeScript]
----
import {RENDER_MODE, XP_REQUEST_TYPE, I18n} from '@enonic/nextjs-adapter';
----
. **Add these imports**
+
[source,TypeScript]
----
import Header from '../../../components/views/Header';
import Footer from '../../../components/views/Footer';
import {getAsset} from '@enonic/nextjs-adapter';
----
+
. And at the bottom of the file **replace the entire return function**:
+
[source,typescriptjsx]
----
    return (
        <LocaleContextProvider locale={params.locale}>
            <StaticContent condition={isEdit}>
                <main>{children}</main>
            </StaticContent>
        </LocaleContextProvider>
    )
----
+
With this:
+
[source,typescriptjsx]
----
    return (
        <LocaleContextProvider locale={params.locale}>
            <StaticContent condition={isEdit}>
                <Header meta={meta} title={I18n.localize('title')} logoUrl={getAsset('/images/xp-shield.svg', meta)}/>
                <main>{children}</main>
                <Footer/>
            </StaticContent>
        </LocaleContextProvider>
    )
----

NOTE: Pay attention to the `getAsset()` function.
It ensures that links to assets are working seamlessly in Next.js, as well as in Content Studio preview mode - as you will see later.

Morgan Freeman's page should now look like this

image:morgan-freeman-header-footer.png[title="Rendering with header and footer",width=768px]

== The common query

You may have noticed the `Common` props appearing in the various prop views - these originate from the the following statement in the mappings:

.src/components/_mappings.ts
[source,TypeScript]
----
...

// Common query
ComponentRegistry.setCommonQuery([commonQuery, commonVariables]);

...
----

The result of this query is available across all components on the page, and may be useful if you want to fetch data for the page itself, or to be used across multiple components. Feel free to adapt it to your requirements.

NOTE: If you do not need any common props, remove it from the mappings to optimize performance.

With the basic rendering completed, in the following chapter, you'll add <<preview#, preview support to Content Studio>>.

